@model DayDetailsViewModel
@{
    ViewBag.Title = Model.Day.Name;
}
<h2>@Model.Day.Name</h2>
<p><em>@String.Format("{0:D}", Model.Day.Date)</em></p>
<p>Coefficient : @String.Format("{0:F1}", Model.Day.Coefficient)</p>
<table class="table table-striped">
    <thead>
        <tr>
            <th>Date</th>
            <th></th>
            <th></th>
            <th></th>
            @foreach (var user in Model.Users)
            {
                <th colspan="2" style="min-width:81px;text-align:center;">@user.Name</th>
            }
        </tr>
    </thead>
    <tbody>
        @foreach (var fixture in Model.Fixtures.OrderBy(x => x.Date))
        {
            <tr>
                <td>
                    @String.Format("{0:g}", fixture.Date)
                </td>
                <td class="home">
                    @Model.Teams.First(t => t.TeamId == fixture.HomeTeamId).Name
                </td>
                <td>
                    @if (fixture.HomeTeamGoals.HasValue && fixture.AwayTeamGoals.HasValue)
                    {
                        @: @fixture.HomeTeamGoals.Value - @fixture.AwayTeamGoals.Value
                    }
                </td>
                <td class="away">
                    @Model.Teams.First(t => t.TeamId == fixture.AwayTeamId).Name
                </td>
                @foreach (var user in Model.Users)
                {
                    var userForecast = Model.Forecasts.FirstOrDefault(f => f.UserId == user.UserId && f.FixtureId == fixture.FixtureId);
                    string forecastResult = string.Empty;
                    string forecastScore = string.Empty;
                    if (userForecast != null)
                    {
                        if (user.UserId == Model.CurrentUserId || !fixture.CanBeForecast)
                        {
                            forecastResult = string.Format("{0} - {1}", userForecast.HomeTeamGoals, userForecast.AwayTeamGoals);
                        }
                        else
                        {
                            forecastResult = "? - ?";
                        }
                        if (userForecast.Score.HasValue)
                        {
                            forecastScore = string.Format("{0:F1}", userForecast.Score.Value);
                        }
                    }
                    <td>@forecastResult</td>
                    <td style="width:20px;text-align:right">@forecastScore</td>
                }
            </tr>
        }
    </tbody>
    <tfoot>
        <tr>
            <td colspan="4"></td>
            @foreach (var user in Model.Users)
            {
                <td colspan="2" style="text-align:right">@String.Format("{0:F1}", Model.Forecasts.Where(x => x.UserId == user.UserId).Sum(x => x.Score))</td>
            }
        </tr>
    </tfoot>
</table>

@if (Model.Fixtures.Any(x => x.CanBeForecast))
{
    <p>@Html.ActionLink("Pronostiquer", "Forecast", new { id = Model.Day.DayId })</p>
}
@if (Request.IsAuthenticated && User.IsInRole("Administrators"))
{
    <p>@Html.ActionLink("Modifier", "Edit", new { id = Model.Day.DayId })</p>
}
